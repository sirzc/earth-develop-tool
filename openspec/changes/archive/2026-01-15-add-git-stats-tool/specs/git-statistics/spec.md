# 能力规约：Git 代码统计

## Purpose

在 IntelliJ IDEA 中提供 Git 代码变动统计功能，支持按多个维度（时间、分支、作者）分析项目的代码提交情况，用于代码审查、绩效评估和项目分析。

## ADDED Requirements

### Requirement: 时间范围选择

系统 SHALL 提供多种方式让用户选择统计的时间范围。

#### Scenario: 按日期范围选择

- **WHEN** 用户在日期范围选项中选择"自定义日期"
- **THEN** 系统应显示开始日期和结束日期的日期选择器，用户可选择任意日期范围

#### Scenario: 快捷相对时间选择

- **WHEN** 用户选择快捷时间选项（如"最近7天"、"最近30天"、"过去一年"）
- **THEN** 系统应自动计算时间范围并应用到统计

#### Scenario: 默认时间范围

- **WHEN** 用户首次打开工具或重置配置
- **THEN** 系统应默认显示"最近30天"的时间范围

### Requirement: 分支过滤

系统 SHALL 支持按指定分支过滤统计结果。

#### Scenario: 加载可用分支列表

- **WHEN** 工具初始化或用户点击分支刷新按钮
- **THEN** 系统应从当前项目的 Git 仓库加载所有本地和远程分支列表

#### Scenario: 单选分支

- **WHEN** 用户从分支列表中选择一个分支
- **THEN** 系统应只统计该分支上的提交记录

#### Scenario: 默认分支

- **WHEN** 未指定分支时
- **THEN** 系统应默认统计当前 HEAD 指向的分支

### Requirement: 作者过滤

系统 SHALL 支持按指定作者过滤统计结果，并支持多选。

#### Scenario: 加载可用作者列表

- **WHEN** 工具初始化或用户点击作者刷新按钮
- **THEN** 系统应从指定时间范围和分支的提交记录中，提取所有唯一的提交作者列表

#### Scenario: 多选作者

- **WHEN** 用户在作者列表中勾选多个作者
- **THEN** 系统应统计选中的所有作者的提交记录，结果应包含所有选中作者的数据

#### Scenario: 全部作者

- **WHEN** 用户选择"全部"或不做任何选择
- **THEN** 系统应统计时间范围和分支内所有作者的提交数据

### Requirement: 代码行数统计

系统 SHALL 统计提交中的新增行数和删除行数。

#### Scenario: 统计增加行数

- **WHEN** 用户点击统计按钮，指定时间范围为"最近30天"、分支为"main"
- **THEN** 系统应计算该分支在该时间内所有提交的新增代码行总数

#### Scenario: 统计删除行数

- **WHEN** 用户点击统计按钮，指定相同的时间范围和分支
- **THEN** 系统应计算该分支在该时间内所有提交的删除代码行总数

#### Scenario: 零提交下的行数统计

- **WHEN** 指定的时间范围内该分支没有新提交
- **THEN** 系统应返回增加行数和删除行数均为 0

### Requirement: 提交次数统计

系统 SHALL 统计指定时间范围、分支、作者条件下的提交总数。

#### Scenario: 统计单个作者提交次数

- **WHEN** 用户选择时间范围"最近7天"、选择分支"feature/xxx"、选择作者为"Alice"
- **THEN** 系统应返回 Alice 在该分支、该时间范围内的提交总次数

#### Scenario: 统计多个作者提交次数

- **WHEN** 用户选择时间范围"最近30天"、选中多个作者（Alice, Bob, Carol）
- **THEN** 系统应返回这三人在指定时间范围内的提交总次数（求和）

#### Scenario: 统计全部作者提交次数

- **WHEN** 用户不选择特定作者
- **THEN** 系统应统计所有作者在指定时间范围和分支内的提交总次数

### Requirement: 修改文件数统计

系统 SHALL 统计指定条件下涉及的修改文件总数。

#### Scenario: 统计修改文件数

- **WHEN** 用户指定时间范围"最近14天"、分支"develop"、作者"David"
- **THEN** 系统应统计 David 在 develop 分支该时间范围内修改过的文件总数（去重）

#### Scenario: 多个提交修改同一文件

- **WHEN** 时间范围内多个提交都修改了同一个文件
- **THEN** 系统应只计算该文件一次（去重计数）

### Requirement: 表格形式结果展示

系统 SHALL 以表格形式清晰展示统计结果，支持数据排序和复制。

#### Scenario: 显示统计汇总表格

- **WHEN** 用户点击统计按钮并成功获取数据
- **THEN** 系统应显示包含以下列的表格：
  - 作者（如果按作者分组）或 "总计"
  - 提交次数
  - 增加行数
  - 删除行数
  - 修改文件数
  - 平均每次提交增加行数（可选）

#### Scenario: 按作者分组显示

- **WHEN** 用户选择多个作者或全部作者进行统计
- **THEN** 系统应显示按作者分组的表格，每行显示一个作者的统计数据，最后一行显示"总计"

#### Scenario: 单个作者统计

- **WHEN** 用户只选择一个作者
- **THEN** 系统可显示简化的单行表格，或选择仍按作者分组显示（取决于 UX 设计）

#### Scenario: 表格数据可复制

- **WHEN** 用户右键点击表格或点击复制按钮
- **THEN** 系统应支持将表格数据复制为：
  - 纯文本格式（制表符分隔）
  - Markdown 表格格式
  - CSV 格式

#### Scenario: 表格列排序

- **WHEN** 用户点击表格列头
- **THEN** 系统应按该列的数值进行升序/降序排序

### Requirement: 统计执行

系统 SHALL 在用户点击统计按钮后，执行 Git 命令获取数据并计算统计结果。

#### Scenario: 成功执行统计

- **WHEN** 用户点击"开始统计"按钮，所有参数有效（分支存在、时间范围合法、作者存在）
- **THEN** 系统应执行 Git 命令，计算统计数据，在 UI 中显示结果表格

#### Scenario: 无结果处理

- **WHEN** 指定条件下没有任何提交记录
- **THEN** 系统应显示"无提交记录"提示，表格为空或显示所有指标均为 0

#### Scenario: Git 命令执行失败

- **WHEN** 当前项目不是 Git 仓库或 Git 命令执行出错
- **THEN** 系统应显示错误提示信息，例如 "当前项目不是有效的 Git 仓库" 或 "Git 命令执行失败: [错误详情]"

#### Scenario: 命令执行超时

- **WHEN** Git 命令执行时间过长（>30秒）
- **THEN** 系统应取消该命令执行，显示超时提示，避免 IDE 卡顿

### Requirement: 页面加载和刷新

系统 SHALL 在工具显示时自动加载分支和作者列表。

#### Scenario: 工具首次显示

- **WHEN** 用户从工具栏打开 Git 统计工具
- **THEN** 系统应自动加载可用分支列表和作者列表，填充 UI 中的下拉框/多选框

#### Scenario: 刷新数据

- **WHEN** 用户点击"刷新"按钮
- **THEN** 系统应重新加载分支列表和作者列表

#### Scenario: 分支变更后更新

- **WHEN** 用户选择不同分支后
- **THEN** 系统应更新作者列表（仅显示该分支上的作者），但不自动重新执行统计

