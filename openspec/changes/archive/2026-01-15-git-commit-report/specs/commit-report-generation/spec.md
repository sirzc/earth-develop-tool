# 规范增量：Git 提交周报生成

## ADDED Requirements

### Requirement: 多仓库提交信息聚合

系统 SHALL 支持从所有 Git 仓库中聚合单个用户的提交信息，并按仓库组织展示。

#### Scenario: 扫描并加载所有作者列表

- **WHEN** 用户打开 Git 提交周报工具
- **THEN** 系统应：
  1. 扫描项目目录下所有 Git 仓库
  2. 从各仓库中提取所有唯一的提交作者名称
  3. 在作者选择下拉框中显示完整列表
  4. 保持加载状态提示，直到完成

#### Scenario: 按作者和时间范围过滤提交

- **WHEN** 用户选择作者（如 "ingerchao"）和时间范围（如 "最近7天"）后点击 "生成报告"
- **THEN** 系统应：
  1. 遍历所有 Git 仓库
  2. 使用 `git log --author=<author> --since=<date> --before=<date>` 获取该作者的提交
  3. 提取提交哈希、日期、提交消息等信息
  4. 聚合结果，生成结构化报告

#### Scenario: 多仓库提交聚合

- **WHEN** 项目包含多个 Git 仓库（如 3 个仓库），用户指定作者和时间范围
- **THEN** 系统应：
  1. 从每个仓库获取该作者的提交
  2. 按仓库分组展示提交信息
  3. 计算跨仓库的统计信息（总提交数、总涉及仓库数等）
  4. 展示结果中应清晰标记每条提交属于哪个仓库

#### Scenario: 无提交的处理

- **WHEN** 选定的作者在指定时间范围内某个仓库无提交
- **THEN** 系统应：
  1. 在该仓库章节中显示 "该作者在此仓库无提交"
  2. 继续处理其他仓库
  3. 不中断报告生成流程

### Requirement: 报告生成与格式化

系统 SHALL 生成结构化的提交周报，支持多种输出格式。

#### Scenario: Markdown 格式报告生成

- **WHEN** 用户选择 Markdown 格式并点击 "生成报告"
- **THEN** 系统应生成包含以下内容的 Markdown 文档：
  - 报告标题：`# Git 提交周报 (日期)`
  - 报告信息：作者、时间范围
  - 按仓库组织的提交列表：
    ```
    ## 仓库: <仓库名>
    - `<哈希>` - <日期> : <提交消息>
    ```
  - 统计总结：仓库总数、有提交的仓库数、总提交数

#### Scenario: 纯文本格式报告生成

- **WHEN** 用户选择纯文本格式
- **THEN** 系统应生成简化的纯文本报告，格式类似 Markdown 但不包含 Markdown 语法

#### Scenario: 报告内容显示

- **WHEN** 报告生成完成
- **THEN** 系统应：
  1. 在 UI 的结果区域显示完整报告内容
  2. 内容应可滚动（如果超过显示区域）
  3. 保持格式清晰，支持复制（使用 Ctrl+C）

#### Scenario: 统计信息准确性

- **WHEN** 报告包含多个仓库的提交数据
- **THEN** 系统应正确计算和显示：
  - 总提交数：所有仓库该作者的提交总数
  - 涉及的仓库数：有该作者提交的仓库数量
  - 统计范围：正确显示开始和结束日期

### Requirement: 时间范围选择

系统 SHALL 提供多种时间范围选择方式，包括快捷预设和手动输入，用于过滤提交。

#### Scenario: 快捷时间范围选择

- **WHEN** 用户从时间范围下拉框选择选项
- **THEN** 系统应支持以下快捷选项并自动计算日期范围：
  - "最近7天"：过去 7 天（从今天算起）
  - "最近30天"：过去 30 天
  - "最近1年"：过去 365 天
  - "全部"：无时间限制，获取所有历史提交

#### Scenario: 自定义日期范围 - 日期选择器

- **WHEN** 用户选择 "自定义日期" 选项
- **THEN** 系统应：
  1. 显示开始日期和结束日期的两个日期选择器
  2. 用户可通过日期选择器弹窗选择任意日期
  3. 选定后自动更新显示的日期范围

#### Scenario: 自定义日期范围 - 手动输入

- **WHEN** 用户选择 "自定义日期" 选项
- **THEN** 系统应提供两个可编辑的文本输入框，用户可直接输入日期：
  - 起始日期输入框：格式 `YYYY-MM-DD`（如 `2025-01-01`）
  - 终止日期输入框：格式 `YYYY-MM-DD`（如 `2025-01-15`）
  - 系统应支持手动输入或通过日期选择器弹窗选择

#### Scenario: 日期格式验证

- **WHEN** 用户在日期输入框中输入日期
- **THEN** 系统应：
  1. 验证日期格式是否为 `YYYY-MM-DD`
  2. 验证日期是否有效（如月份 1-12、日期 1-31）
  3. 若格式错误，显示错误提示 "请输入有效的日期格式 (YYYY-MM-DD)"
  4. 若起始日期 > 终止日期，显示警告提示

#### Scenario: 默认时间范围

- **WHEN** 工具初次打开
- **THEN** 系统应默认选择 "最近7天" 作为初始时间范围

#### Scenario: 快捷选项与自定义日期的切换

- **WHEN** 用户从快捷选项（如 "最近30天"）切换到 "自定义日期"
- **THEN** 系统应显示日期输入框，起始日期默认为 30 天前，终止日期默认为今天
- **WHEN** 用户从 "自定义日期" 切换到快捷选项（如 "最近7天"）
- **THEN** 系统应隐藏日期输入框，使用快捷选项计算的日期范围

### Requirement: 作者选择

系统 SHALL 支持从所有提交作者中选择单个作者。

#### Scenario: 单作者选择

- **WHEN** 用户点击作者选择下拉框
- **THEN** 系统应显示所有可用的作者名称列表（从所有仓库收集）

#### Scenario: 作者列表加载

- **WHEN** 用户首次打开工具或点击 "刷新" 按钮
- **THEN** 系统应：
  1. 在后台扫描所有 Git 仓库
  2. 提取所有唯一的提交作者名称
  3. 在作者下拉框中显示这些名称
  4. 提供加载进度反馈

#### Scenario: 作者变更后重新生成

- **WHEN** 用户更改选定的作者或时间范围，然后点击 "生成报告"
- **THEN** 系统应重新生成报告，显示新选定作者的提交

### Requirement: 用户交互与操作

系统 SHALL 提供便捷的操作按钮和结果管理功能。

#### Scenario: 生成报告

- **WHEN** 用户选择作者、时间范围、格式后点击 "生成报告" 按钮
- **THEN** 系统应：
  1. 显示加载状态（如 "正在处理 X/Y 仓库..."）
  2. 在后台执行提交信息收集和报告生成
  3. 报告完成后更新 UI，显示完整内容
  4. 更新状态为 "报告已生成"

#### Scenario: 复制报告内容

- **WHEN** 用户点击 "复制" 按钮或使用 Ctrl+C
- **THEN** 系统应将当前显示的报告内容复制到系统剪贴板，显示 "已复制" 提示

#### Scenario: 导出为文件（可选）

- **WHEN** 用户点击 "导出文件" 按钮
- **THEN** 系统应：
  1. 打开文件保存对话框
  2. 根据选定格式建议文件扩展名（如 `.md` 或 `.txt`）
  3. 将报告内容保存到用户指定的位置
  4. 显示保存成功提示

#### Scenario: 清空结果

- **WHEN** 用户点击 "清空" 按钮
- **THEN** 系统应清空报告显示区域，恢复到初始状态

### Requirement: 性能与进度反馈

系统 SHALL 在处理多个仓库时提供进度反馈，并确保 UI 响应。

#### Scenario: 长时间操作的进度提示

- **WHEN** 项目包含多个 Git 仓库，用户点击 "生成报告"
- **THEN** 系统应在状态标签中显示实时进度：
  - "正在处理... (1/5 仓库)"
  - "正在处理... (2/5 仓库)"
  - 等等...

#### Scenario: 后台处理不阻塞 UI

- **WHEN** 报告生成进行中
- **THEN** 系统应：
  1. 使用后台线程执行 Git 操作
  2. UI 始终保持响应
  3. 用户可以切换工具或执行其他操作
  4. 报告完成后立即在 UI 中显示

#### Scenario: 处理超时保护

- **WHEN** 某个 Git 命令执行超过 30 秒
- **THEN** 系统应：
  1. 取消该命令
  2. 记录警告并继续处理其他仓库
  3. 在最终报告中标注该仓库 "处理超时，数据可能不完整"

### Requirement: 错误处理与恢复

系统 SHALL 妥善处理各种异常情况，不中断报告生成。

#### Scenario: 仓库无法访问

- **WHEN** 某个 Git 仓库无法访问或权限不足
- **THEN** 系统应：
  1. 记录警告信息
  2. 在报告中标注该仓库 "无法访问"
  3. 继续处理其他仓库

#### Scenario: 特殊字符处理

- **WHEN** 提交消息包含特殊字符（如换行、制表符、中文等）
- **THEN** 系统应正确处理这些字符，避免格式破坏或乱码

#### Scenario: 无效输入处理

- **WHEN** 用户选择的作者在任何仓库中都无提交
- **THEN** 系统应生成空报告并显示提示 "选定作者在指定时间范围内无提交"

